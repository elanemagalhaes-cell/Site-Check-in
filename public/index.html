<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Check-in HUB</title>
    <style>
      body {
        background: #fff;
        font-family: Arial, sans-serif;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
      }
      .card {
        background: #fffaf5;
        padding: 2rem;
        border-radius: 20px;
        box-shadow: 0 0 10px #ff7b00a1;
        text-align: center;
        width: 300px;
      }
      h2 {
        color: #ff6600;
        margin-bottom: 1rem;
      }
      input {
        width: 100%;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 8px;
      }
      button {
        margin-top: 1rem;
        width: 100%;
        padding: 12px;
        background: #ff6600;
        color: white;
        font-weight: bold;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }
      #status {
        margin-top: 1rem;
        font-weight: bold;
      }
      .logo {
        width: 100px;
      }
    </style>
  </head>

  <body>
    <img
      src="https://cf.shopee.com.br/file/b0f9b7d0f9b7b0f9b7d0.png"
      alt="Shopee Mascote"
      class="logo"
    />

    <div class="card">
      <h2>üìç Check-in HUB</h2>
      <input id="input-id" placeholder="Digite seu ID" />
      <button id="btn-checkin">Registrar</button>
      <div id="status">Ative o GPS e permita a localiza√ß√£o.</div>
    </div>

    <script>
      const btn = document.querySelector("#btn-checkin");
      const inputId = document.querySelector("#input-id");
      const statusEl = document.querySelector("#status");

      const show = (msg, ok = false) => {
        statusEl.textContent = msg;
        statusEl.style.color = ok ? "#2e7d32" : "#c62828";
      };

      const getPosition = () =>
        new Promise((resolve, reject) =>
          navigator.geolocation.getCurrentPosition(resolve, reject, {
            enableHighAccuracy: true,
            timeout: 15000,
            maximumAge: 0,
          })
        );

      btn.addEventListener("click", async () => {
        const id = inputId.value.trim();
        if (!id) return show("Informe seu ID!");

        show("‚è≥ Obtendo localiza√ß√£o...");
        let pos;
        try {
          pos = await getPosition();
        } catch (e) {
          return show("Erro ao obter localiza√ß√£o. Ative o GPS.");
        }

        const body = {
          id,
          lat: pos.coords.latitude,
          lng: pos.coords.longitude,
          acc: pos.coords.accuracy,
          deviceId:
            localStorage.deviceId ??
            (localStorage.deviceId = crypto.randomUUID()),
          ua: navigator.userAgent,
        };

        const res = await fetch("/api/checkin", {
          method: "POST",
          headers: { "content-type": "application/json" },
          body: JSON.stringify(body),
        });

        const json = await res.json().catch(() => null);
        if (json?.ok) {
          show(json.msg, true);
        } else {
          show(json?.msg || "Falha ao enviar o check-in.");
        }
      });
    </script>
  </body>
</html>
